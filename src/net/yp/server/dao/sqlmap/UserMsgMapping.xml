<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD iBatis Mapper 3.0 //EN" "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">

<mapper namespace="net.yp.server.dao.UserMsgMapper">

	<!-- 获取联系人分组信息 -->
	<select id="queryUserGroup" parameterType="Map" resultType="UserGroup">
		select id,name from tb_user_group
	</select>

	<!-- 获取联系人分组记录数 -->
	<select id="queryUserGroupCount" parameterType="Map" resultType="Long">
		select count(1) from tb_user_group where 1=1
		<if test="name!=null">
			and name=#{name,jdbcType=VARCHAR}
		</if>
	</select>
	
	<!-- 根据组获取联系人信息 -->
	<select id="queryUserMsgByGroup" parameterType="Map" resultType="UserMsg">
		select t1.id,t1.name,t1.phoneNumber from tb_user_msg
		t1,tb_user_group_rel t2,tb_user_group t3
		where t1.id=t2.msgId and
		t2.groupId=t3.id and t2.groupId=#{groupId,jdbcType=VARCHAR}
	</select>
	
	<!-- 根据组获取联系人信息记录数 -->
	<select id="queryUserMsgByGroupCount" parameterType="Map" resultType="Long">
		select count(1) from tb_user_msg
		t1,tb_user_group_rel t2,tb_user_group t3
		where t1.id=t2.msgId and
		t2.groupId=t3.id and t2.groupId=#{groupId,jdbcType=VARCHAR}
	</select>
	
	<!-- 根据联系人姓名和电话号码判断是否已存在 -->
	<select id="queryUserMsgCountByNameAndPhoneNumber" parameterType="UserMsg" resultType="Long">
		select count(1) from tb_user_msg where 
		name=#{name,jdbcType=VARCHAR} and phoneNumber=#{phoneNumber,jdbcType=VARCHAR}
	</select>	
	
	<!-- 新增联系人信息 -->
	<insert id="addUserMsg" parameterType="UserMsg">
		insert into tb_user_msg(id,name,phoneNumber)
		values(#{id,jdbcType=VARCHAR},#{name,jdbcType=VARCHAR},#{phoneNumber,jdbcType=VARCHAR})
	</insert>
	
</mapper>	